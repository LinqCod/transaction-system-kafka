# Система транзакций

### Как происходит транзакция:
- Идет запрос на сервер от клиента, по клиенту выстраивается очередь на вывод.
#### Важно:
    1. У каждого клиента есть своя очередь
    2. при нехватке денег, нужно блокировать запрос
### Что нужно реализовать :
1. бд на postgresql, где будет схема с клиентами и их балансами
2. сервер, который проверяет все условия:
    - Хватает ли денег для снятия
    - Если сервер упадет, то история, которая идет на вывод не должна пропасть
    - Изменение баланса(на + или -)

# Реализация
- Основная концепция основана на работе с брокерами сообщений (в данном случае kafka)
- Персистентность данных достигается благодаря способу их хранения в kafka
- При падении основного сервиса данные не продадут из очереди сообщений, и их можно будет продолжить обрабатывать
- в консьюмере (воркер) реализована валидация денежных средств (дабы баланс не ушел в минус)
- 

# Запуск
## Запуск брокера:
- MY_IP={YOUR_IP} docker-compose -f docker-compose-kafka.yml up
## Создание бд:
- make postgres
- make create_db
## Команда создания топика:
- docker run --net=host --rm confluentinc/cp-kafka:5.0.0 kafka-topics --create --topic transactions-queue --partitions 4 --replication-factor 2 --if-not-exists --zookeeper localhost:32181
## Также необходимо запустить продьюсера и консьюмера